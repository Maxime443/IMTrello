{% extends "base.html" %} {% block title %}Home{% endblock %}

{% block content %}
<h1 align="center">
<br />
    {% if user.type=='PROJECT_MANAGER' %}
    You are a project manager
    {% else %}
    You are a developer
    {% endif %}
</h1>
<h2 align="left">
    <br />
    Your projects :<br />

<br>
</h2>
<ul class="list-group list-group-flush" id="notes">
  {% for project in user.projects | sort(attribute='id') %}
  <li class="list-group-item">
    {{ project.name }}
    <button type="button" class="btn btn-primary" onClick="open_Project({{ project.id }})">
        Open
    </button>
    <button type="button" class="btn btn-primary" onclick="showModal({{ project.id }})">
        Rename
    </button>

        <button type="button" class="close" onClick="delete_Project({{ project.id }})">
      <span aria-hidden="true">&times;</span>
    </button>

  </li>
  {% endfor %}
</ul>
<div class="modal fade" id="modal1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Nouveau Projet
                </h5>
                <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST">
            <div class="modal-body">
                        <div class="form-group">
                            <label for="name">Project name</label>
                            <input type="text"
                                   class="form-control"
                                   id="name"
                                   name="name"
                                   placeholder="Your project name"/>
                        </div>
                        <div class="form-group">
                            <label for="description">Description</label>
                            <input type="text"
                                   class="form-control"
                                   id="description"
                                   name="description"
                                   placeholder="Describe your project"/>
                        </div>
                        <div class="form-group">
                            <label for="end_date">End of your project</label>
                            <input type="date"
                                   class="form-control"
                                   id="end_date"
                                   name="end_date"
                                   placeholder=""/>
                        </div>
            </div>
            <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" >Cr√©er Projet</button>
            </div>
            </form>
        </div>
    </div>
</div>

<!-- this is the modal for the rename popup -->
<div class="modal fade" id="modal_rename_project">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Rename
                </h5>
                <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST">
            <div class="modal-body">
                        <div class="form-group">
                            <label for="name">Project name
                            <input type="text"
                                   class="form-control"
                                   id="name1"
                                   name="name1"
                                   placeholder="Your project name"/>
                                </label>
                        </div>
                                <input type="hidden"
                                   class="form-control"
                                   id="project_id"
                                   name="project_id"
                                   placeholder="project_id"
                                   value=""/>


            </div>
            <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" >Rename Project</button>
            </div>
            </form>
        </div>
    </div>
</div>
<script>
function open_Project(projectId) {
    // Redirect the user to the project page with the project ID as part of the URL
    window.location.href = "/project/" + projectId;
}
 function delete_Project(projectId) {
  fetch("/delete-project", {
    method: "POST",
    body: JSON.stringify({ projectId: projectId }),
  }).then((_res) => {
    window.location.href = "/";
  });
  }

function showModal(projectId) {
        // Set the value of the hidden input field with the project ID
        document.getElementById('project_id').value = projectId;
        // Show the modal
        $('#modal_rename_project').modal('show');
    }

</script>
{% endblock %}