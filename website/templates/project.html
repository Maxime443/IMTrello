{% extends "base.html" %} {% block title %}Project{% endblock %}
{% block share %}
    <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modal_share">
        Share
</button>
{% endblock %}
{% block content
%}
<div display="flex">
<h1 align="center" draggable="true">
    {{ project.name }}
</h1>
</div>


<ol class="list-group list-group-flush" id="sections">
	{% for section in project.sections %}
	<li class="section" id="section-{{ section.id }}">
		<div class="card">
			<div class="card_header">
				<div class="editableContent" data-section-id="{{ section.id }}">{{ section.name }}</div>
				<button type="button" class="btn-close btn-close-white" onClick="deleteSection({{ section.id }},{{ project.id }})"></button>
			</div>
			<div class="card_content">
				<ol class="list-group list-group-flush task-list" data-section-id="{{ section.id }}">
					{% for task in section.tasks | sort(attribute='order') %}
						<li data-task-id="{{ task.id }}" draggable="true" class="li_task">
							<div class="task">
								{{ task.name }}
							</div>
						</li>
					{% endfor %}
				</ol>
			</div>
			{% if user.type=='PROJECT_MANAGER' %}
				<div class="card_footer">
					<button type="button" class="add-card-btn btn-dark btn" onclick="showModalforNewTask({{ section.id }})"><i class="fas fa-plus"></i>Add task</button>
				</div>
			{% endif %}
		</div>
	</li>
	{% endfor %}
	{% if user.type=='PROJECT_MANAGER' %}
		<div class="add_section">
			<button type="button" class="btn_section btn btn-dark" onclick="createSectionForm()">
				<i class="fas fa-plus"></i>New Section
		    </button>
		</div>
	{% endif %}
</ol>

{#	Modal new_section#}
<div class="modal fade" id="modal_new_section">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    New Section
                </h5>
                <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST">
            <input type="hidden" name="action" value="add_section">
            <div class="modal-body">
                        <div class="form-group">
                            <label for="name">Section Name</label>
                            <input type="text"
                                   class="form-control"
                                   id="section_name"
                                   name="section_name"
                                   placeholder="This section's name"/>
                        </div>

            </div>
            <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" >Create Section</button>
            </div>
            </form>
        </div>
    </div>
</div>

{#	Modal for sharing to devs #}
<div class="modal fade" id="modal_share">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Add developers
                </h5>
                <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <input type="hidden" name="action" value="add_developer">
             <form method="POST" action="/project/{{ project.id }}">
             <input type="hidden" name="action" value= "add_developer">
	         <div class="modal-body">
             <label for="name">Share to</label>
	         <div class="form-group">
                 <select id="developer_emails"
			             name="developer_emails"
			             class="js-example-basic-multiple"
			             multiple="multiple">
			         {% for email in user_emails %}
			         <option value="{{ email }}">{{ email }}</option>
			         {% endfor %}
			     </select>
	         </div>
            </div>
            <div class="modal-footer">
	            <button type="submit" class="btn btn-primary" >Add</button>
            </div>
            </form>
        </div>
    </div>
</div>

{#Modal for new_task#}
<div class="modal fade" id="modal_new_task">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    New Task
                </h5>
                <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST">
	            <input type="hidden" name="action" value="add_task">
	            <input type="hidden" name="task_section_id" id="task_section_id" value="">
	            <div class="modal-body">
		            <div class="form-group">
			            <label for="name">Task Name</label>
			            <input type="text"
			                   class="form-control"
			                   id="task_name"
			                   name="task_name"
			                   placeholder="This task's name"/>
		            </div>
		            <div class="form-group">
			            <label for="description">Task Description</label>
			            <input type="text"
			                   class="form-control"
			                   id="task_description"
			                   name="task_description"
			                   placeholder="This task's description"/>
		            </div>
	            </div>
	            <div class="modal-footer">
	                <button action="add_task" type="submit" class="btn btn-primary" >Add Task</button>
	            </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}